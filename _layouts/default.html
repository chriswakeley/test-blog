<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if page.title %}{{ page.title }} · {% endif %}{{ site.title }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ '/assets/css/tailwind.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
  {% seo %}
  <link rel="icon" type="image/png" href="{{ '/assets/images/stressburner-faviconlogo.png' | relative_url }}">
  <link rel="apple-touch-icon" href="{{ '/assets/images/stressburner-faviconlogo.png' | relative_url }}">
  <meta name="theme-color" content="#9A0C0C">
</head>
<body class="page-{{ page.title | downcase | replace: ' ', '-' }}">
  <header class="sb-header">
    <div class="container header-inner">
      <a class="brand" href="{{ '/' | relative_url }}" aria-label="{{ site.title }}">
        <img src="{{ '/assets/images/logo-large.png' | relative_url }}" alt="Stress Burner lotus logo" />
      </a>
      <button class="nav-toggle" aria-expanded="false" aria-controls="primary-nav">☰</button>
      <nav id="primary-nav" class="nav">
        {% for item in site.nav %}
          {% if item.external %}
            <a href="{{ item.external }}" class="nav-link" target="_blank" rel="noopener">{{ item.title }}</a>
          {% else %}
            <a href="{{ item.url | relative_url }}" class="nav-link{% if page.url == item.url %} active{% endif %}">{{ item.title }}</a>
          {% endif %}
        {% endfor %}
      </nav>
    </div>
  </header>

  <main>
    {{ content }}
  </main>

  <footer class="sb-footer">
    <div class="container">
      <p>© {{ site.time | date: '%Y' }} {{ site.title }} · <a href="{{ '/contact/' | relative_url }}">Contact</a></p>
    </div>
  </footer>
  <script>
    (function(){
      const btn = document.querySelector('.nav-toggle');
      const nav = document.getElementById('primary-nav');
      if(btn && nav){
        btn.addEventListener('click', () => {
          const open = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', String(!open));
          nav.classList.toggle('open', !open);
        });
      }
      // Progressive header blur/background on scroll (home page only)
      const header = document.querySelector('.sb-header');
      const isHome = document.body.classList.contains('page-home');
      if (header && isHome) {
        let ticking = false;
        const max = 180; // px of scroll to reach full effect
        const update = () => {
          const y = window.scrollY || window.pageYOffset || 0;
          const t = Math.max(0, Math.min(1, y / max));
          header.style.setProperty('--header-bg', (0.75 * t).toFixed(3));
          header.style.setProperty('--header-blur', (8 * t).toFixed(2) + 'px');
          header.style.setProperty('--header-border', (0.06 * t).toFixed(3));
          ticking = false;
        };
        update();
        window.addEventListener('scroll', () => {
          if (!ticking) {
            ticking = true;
            requestAnimationFrame(update);
          }
        }, { passive: true });
      }

      // Inject flowers SVG inline into hero so we can style stroke/fill via CSS (no edits to the SVG file itself)
      const heroContainer = document.querySelector('.hero .container');
      if (heroContainer) {
        // Ensure background layers exist for animation/parallax
        const ensureLayer = (cls) => {
          let el = heroContainer.querySelector(`.${cls}`);
          if (!el) {
            el = document.createElement('div');
            el.className = `bg-layer ${cls}`;
            heroContainer.insertBefore(el, heroContainer.firstChild);
          }
          return el;
        };
        const bg0 = ensureLayer('bg-0');
        const bg1 = ensureLayer('bg-1');

        // Parallax setup (outside fetch so it always runs)
        const heroSection = document.querySelector('.hero');
        const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        let flowers = null;
        let ticking2 = false;
        const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
        const px = (n) => `${Math.round(n)}px`;
        const updateParallax = () => {
          if (!heroSection || prefersReduced) { ticking2 = false; return; }
          const rect = heroSection.getBoundingClientRect();
          const vh = window.innerHeight || document.documentElement.clientHeight || 0;
          // Progress across viewport: 0 when section just enters, 1 when it leaves
          const t = clamp((vh - rect.top) / (vh + rect.height), 0, 1);
          // Scale motion, slightly stronger so it's noticeable but still subtle
          const isMobile = (window.innerWidth || 0) <= 900;
          const scale = isMobile ? 0.7 : 1;
          const m0 = 24 * scale;   // far background
          const m1 = 44 * scale;   // foreground
          const mf = 64 * scale;   // flowers overlay
          if (bg0) bg0.style.transform = `translate3d(0, ${px(t * m0)}, 0)`;
          if (bg1) bg1.style.transform = `translate3d(0, ${px(t * m1)}, 0)`;
          if (flowers) flowers.style.transform = `translate3d(0, ${px(t * mf)}, 0)`;
          ticking2 = false;
        };
        const onScroll = () => { if (!ticking2) { ticking2 = true; requestAnimationFrame(updateParallax); } };
        window.addEventListener('scroll', onScroll, { passive: true });
        window.addEventListener('resize', () => { requestAnimationFrame(updateParallax); }, { passive: true });
        updateParallax();

        // Fetch and inline the flowers SVG (so CSS can style it)
        const svgUrl = '{{ "/assets/images/hero-background-layer-flowers.svg" | relative_url }}';
        try {
          fetch(svgUrl, { cache: 'force-cache' })
            .then(r => r.ok ? r.text() : Promise.reject(r.status))
            .then(svgText => {
              const wrap = document.createElement('div');
              wrap.className = 'flowers-layer';
              wrap.innerHTML = svgText;
              // Normalize dimensions and aspect ratio handling so CSS centering works consistently
              const svgEl = wrap.querySelector('svg');
              if (svgEl) {
                svgEl.removeAttribute('width');
                svgEl.removeAttribute('height');
                svgEl.setAttribute('preserveAspectRatio', 'xMidYMid meet');
              }
              heroContainer.appendChild(wrap);
              flowers = wrap;
              // Apply an initial parallax position now that flowers exist
              requestAnimationFrame(updateParallax);
            })
            .catch(() => { /* no-op if SVG fails to load */ });
        } catch { /* ignore */ }
      }
    })();
  </script>
</body>
</html>