<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}</title>
    <link rel="stylesheet" href="{{ '/assets/css/styles.css' | relative_url }}">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Libre+Bodoni:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="site-wrapper">
        <header>
            <div class="header-content">
                <h1>{{ site.title }}</h1>
                
                <!-- Mobile hamburger button -->
                <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                
                <!-- Desktop navigation -->
                <nav class="desktop-nav">
                    <ul>
                        <li><a href="{{ '/' | relative_url }}">Home</a></li>
                        <li><a href="{{ '/classes/' | relative_url }}">Classes</a></li>
                        <li><a href="{{ '/about/' | relative_url }}">About</a></li>
                        <li><a href="{{ '/posts/' | relative_url }}">Blog</a></li>
                        <li><a href="#" onclick="alert('Schedule coming soon! Call us at (555) 123-YOGA')">Schedule</a></li>
                        <li><a href="#" onclick="alert('Contact us at hello@serenityflow.com')">Contact</a></li>
                    </ul>
                </nav>
            </div>
            
            <!-- Mobile navigation overlay -->
            <nav class="mobile-nav">
                <ul>
                    <li><a href="{{ '/' | relative_url }}" onclick="closeMobileMenu()">Home</a></li>
                    <li><a href="{{ '/classes/' | relative_url }}" onclick="closeMobileMenu()">Classes</a></li>
                    <li><a href="{{ '/about/' | relative_url }}" onclick="closeMobileMenu()">About</a></li>
                    <li><a href="{{ '/posts/' | relative_url }}" onclick="closeMobileMenu()">Blog</a></li>
                    <li><a href="#" onclick="alert('Schedule coming soon! Call us at (555) 123-YOGA'); closeMobileMenu()">Schedule</a></li>
                    <li><a href="#" onclick="alert('Contact us at hello@serenityflow.com'); closeMobileMenu()">Contact</a></li>
                </ul>
            </nav>
        </header>

        <main class="main-content">
            {{ content }}
        </main>

        <footer>
            <div class="social-links">
                <h3>Connect With Our Community</h3>
                <div class="social-icons">
                    {% if site.social_links.instagram %}
                    <a href="https://instagram.com/{{ site.social_links.instagram }}" target="_blank" rel="noopener">
                        <span class="social-icon">üì∑</span> Instagram
                    </a>
                    {% endif %}
                    
                    {% if site.social_links.youtube %}
                    <a href="https://youtube.com/c/{{ site.social_links.youtube }}" target="_blank" rel="noopener">
                        <span class="social-icon">üì∫</span> YouTube
                    </a>
                    {% endif %}
                    
                    {% if site.social_links.facebook %}
                    <a href="https://facebook.com/{{ site.social_links.facebook }}" target="_blank" rel="noopener">
                        <span class="social-icon">üë•</span> Facebook
                    </a>
                    {% endif %}
                    
                    {% if site.social_links.twitter %}
                    <a href="https://twitter.com/{{ site.social_links.twitter }}" target="_blank" rel="noopener">
                        <span class="social-icon">üê¶</span> Twitter
                    </a>
                    {% endif %}
                    
                    {% if site.social_links.pinterest %}
                    <a href="https://pinterest.com/{{ site.social_links.pinterest }}" target="_blank" rel="noopener">
                        <span class="social-icon">üìå</span> Pinterest
                    </a>
                    {% endif %}
                </div>
                <div style="margin-top: 1rem;">
                    <p>üìß {{ site.email }} | üì± (555) 123-YOGA</p>
                    <p>üßò‚Äç‚ôÄÔ∏è "Find your inner peace through mindful movement"</p>
                </div>
            </div>
            <p style="margin-top: 1rem; opacity: 0.8;">&copy; 2024 {{ site.author }}. All rights reserved.</p>
        </footer>
    </div>

    <script>
        function handlePurchase() {
            alert('Thanks for your interest in "Mindful Flow"! This is a demo book - visit our studio to learn about our real yoga resources and workshops. üßò‚Äç‚ôÄÔ∏è');
        }

        // Mobile menu functionality
        function toggleMobileMenu() {
            const mobileNav = document.querySelector('.mobile-nav');
            const hamburger = document.querySelector('.mobile-menu-toggle');
            
            if (mobileNav.classList.contains('active')) {
                mobileNav.classList.remove('active');
                hamburger.classList.remove('active');
                document.body.style.overflow = '';
            } else {
                mobileNav.classList.add('active');
                hamburger.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeMobileMenu() {
            const mobileNav = document.querySelector('.mobile-nav');
            const hamburger = document.querySelector('.mobile-menu-toggle');
            
            mobileNav.classList.remove('active');
            hamburger.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Add event listener when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            const hamburger = document.querySelector('.mobile-menu-toggle');
            if (hamburger) {
                hamburger.addEventListener('click', toggleMobileMenu);
            }

            // Close menu when clicking outside
            document.addEventListener('click', function(event) {
                const mobileNav = document.querySelector('.mobile-nav');
                const hamburger = document.querySelector('.mobile-menu-toggle');
                
                if (mobileNav && mobileNav.classList.contains('active') && 
                    !mobileNav.contains(event.target) && 
                    !hamburger.contains(event.target)) {
                    closeMobileMenu();
                }
            });

            // Close menu on escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeMobileMenu();
                }
            });
        });
    </script>

    <!-- Web Builder integration script -->
    <script>
        (function() {
            console.log('Web Builder integration script loaded');
            
            let selectModeEnabled = false;
            let clickHandler = null;

            // Add CSS for highlighting
            const style = document.createElement('style');
            style.id = 'web-builder-style';
            style.textContent = `
                .web-builder-highlight {
                    outline: 2px solid #3b82f6 !important;
                    outline-offset: 2px !important;
                    background-color: rgba(59, 130, 246, 0.1) !important;
                }
            `;
            document.head.appendChild(style);

            // Listen for messages from parent (React app)
            window.addEventListener('message', function(event) {
                console.log('Received message:', event.data);
                
                if (event.data.type === 'setSelectMode') {
                    selectModeEnabled = event.data.enabled;
                    console.log('Select mode', selectModeEnabled ? 'enabled' : 'disabled');
                    
                    // Remove all highlights when disabling
                    if (!selectModeEnabled) {
                        document.querySelectorAll('.web-builder-highlight').forEach(el => {
                            el.classList.remove('web-builder-highlight');
                        });
                    }
                } else if (event.data.type === 'injectScript') {
                    selectModeEnabled = event.data.selectMode;
                    console.log('Script injection requested, select mode:', selectModeEnabled);
                } else if (event.data.type === 'clearHighlights') {
                    console.log('Clearing all highlights');
                    document.querySelectorAll('.web-builder-highlight').forEach(el => {
                        el.classList.remove('web-builder-highlight');
                    });
                }
            });

            // Create click handler
            clickHandler = function(e) {
                if (!selectModeEnabled) return;
                
                console.log('Element clicked in select mode:', e.target);
                e.preventDefault();
                e.stopPropagation();
                
                // Remove previous highlights
                document.querySelectorAll('.web-builder-highlight').forEach(el => {
                    el.classList.remove('web-builder-highlight');
                });
                
                // Add highlight to clicked element
                e.target.classList.add('web-builder-highlight');
                
                // Generate CSS selector
                const selector = generateSelector(e.target);
                console.log('Generated selector:', selector);
                
                // Send selector to backend
                fetch('http://localhost:8000/api/selection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ selector: selector })
                }).then(response => {
                    console.log('Backend response:', response.status);
                    return response.json();
                }).then(data => {
                    console.log('Selection saved:', data);
                    // Notify parent window
                    parent.postMessage({ type: 'elementSelected', selector: selector }, '*');
                }).catch(error => {
                    console.error('Failed to save selection:', error);
                });
            };

            // Add click handler
            document.addEventListener('click', clickHandler, true);

            function generateSelector(element) {
                if (element.id) {
                    return '#' + element.id;
                }
                
                let selector = element.tagName.toLowerCase();
                
                if (element.className) {
                    const classes = element.className.split(' ').filter(c => c && !c.includes('web-builder'));
                    if (classes.length > 0) {
                        selector += '.' + classes.join('.');
                    }
                }
                
                // Add parent context if needed for uniqueness
                let parent = element.parentElement;
                if (parent && parent !== document.body) {
                    const siblings = Array.from(parent.children).filter(child => 
                        child.tagName === element.tagName
                    );
                    if (siblings.length > 1) {
                        const index = siblings.indexOf(element);
                        selector += ':nth-of-type(' + (index + 1) + ')';
                    }
                }
                
                return selector;
            }

            // Notify parent that script is ready
            if (window.parent !== window) {
                parent.postMessage({ 
                    type: 'webBuilderReady',
                    url: window.location.pathname
                }, '*');
            }

            // Track navigation changes and notify parent
            let lastUrl = window.location.pathname;
            const checkForNavigation = () => {
                if (window.location.pathname !== lastUrl) {
                    lastUrl = window.location.pathname;
                    if (window.parent !== window) {
                        parent.postMessage({ 
                            type: 'navigation',
                            url: window.location.pathname
                        }, '*');
                    }
                }
            };

            // Check for navigation changes periodically (for SPA-style navigation)
            setInterval(checkForNavigation, 500);

            // Also listen for popstate events (back/forward navigation)
            window.addEventListener('popstate', () => {
                setTimeout(checkForNavigation, 100);
            });

            // Track navigation changes and notify parent
            let lastUrl = window.location.pathname;
            const checkForNavigation = () => {
                if (window.location.pathname !== lastUrl) {
                    lastUrl = window.location.pathname;
                    if (window.parent !== window) {
                        parent.postMessage({ 
                            type: 'navigation',
                            url: window.location.pathname
                        }, '*');
                    }
                }
            };

            // Check for navigation changes periodically (for SPA-style navigation)
            setInterval(checkForNavigation, 500);

            // Also listen for popstate events (back/forward navigation)
            window.addEventListener('popstate', () => {
                setTimeout(checkForNavigation, 100);
            });
        })();
    </script>
</body>
</html>